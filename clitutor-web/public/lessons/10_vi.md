# The vi Editor

**vi** (and its modern successor **vim**) is a text editor available on
virtually every Unix/Linux system. It uses **modal editing** -- different
modes for inserting text versus navigating and issuing commands. While the
learning curve is steep, vi is incredibly efficient once you build the muscle
memory.

> **Tip:** Run `vimtutor` on your system for an interactive built-in tutorial.

## The Two Main Modes

| Mode | Purpose | How to Enter |
|------|---------|-------------|
| **Normal mode** | Navigate, delete, copy, paste | Press `Esc` |
| **Insert mode** | Type/edit text | Press `i`, `a`, `o`, etc. |

When you open vi, you start in **Normal mode**. Press `i` to enter Insert
mode (you will see `-- INSERT --` at the bottom). Press `Esc` to return to
Normal mode.

```bash
vi filename.txt          # open or create a file
vim filename.txt         # same thing with vim
```

<!-- exercise
id: ex01
title: Create a config file with vi-style workflow
xp: 10
difficulty: 1
sandbox_setup: null
validation_type: file_contains
expected: vifile.txt::PermitRootLogin no
hints:
  - "For this exercise, create the file using echo (simulating a vi save)."
  - "We are simulating the result of a vi editing session."
  - "Type: `echo 'PermitRootLogin no' > vifile.txt`"
-->
### Exercise 1: Create a config file (simulated vi save)
Create a file called `vifile.txt` containing `PermitRootLogin no` (simulating saving an sshd_config edit in vi).

---

## Navigation in Normal Mode

In Normal mode, you navigate without arrow keys (though arrow keys work too):

### Basic Movement
| Key | Action |
|-----|--------|
| `h` | Left |
| `j` | Down |
| `k` | Up |
| `l` | Right |

### Word Movement
| Key | Action |
|-----|--------|
| `w` | Next word (beginning) |
| `b` | Previous word (beginning) |
| `e` | End of current word |

### Line Movement
| Key | Action |
|-----|--------|
| `0` | Beginning of line |
| `$` | End of line |
| `^` | First non-blank character |

### File Movement
| Key | Action |
|-----|--------|
| `gg` | Go to first line |
| `G` | Go to last line |
| `42G` | Go to line 42 |
| `Ctrl+d` | Page down |
| `Ctrl+u` | Page up |

<!-- exercise
id: ex02
title: Create a multi-line config draft
xp: 10
difficulty: 1
sandbox_setup: null
validation_type: file_contains
expected: practice.txt::MaxAuthTries 3
hints:
  - "Create a file with multiple lines for practicing navigation."
  - "Use printf with \\n for newlines."
  - "Type: `printf 'Port 22\\nPermitRootLogin no\\nMaxAuthTries 3\\nPubkeyAuthentication yes\\nPasswordAuthentication no\\n' > practice.txt`"
-->
### Exercise 2: Create a multi-line config draft
Create `practice.txt` with five lines of SSH config directives (including `MaxAuthTries 3`).

---

## Entering Insert Mode

There are several ways to enter Insert mode from Normal mode:

| Key | Action |
|-----|--------|
| `i` | Insert before cursor |
| `a` | Append after cursor |
| `I` | Insert at beginning of line |
| `A` | Append at end of line |
| `o` | Open new line below |
| `O` | Open new line above |

Always press `Esc` to return to Normal mode when done typing.

---

## Editing in Normal Mode

### Delete
| Command | Action |
|---------|--------|
| `x` | Delete character under cursor |
| `dd` | Delete entire line |
| `dw` | Delete word |
| `d$` or `D` | Delete to end of line |
| `3dd` | Delete 3 lines |

### Copy and Paste (Yank and Put)
| Command | Action |
|---------|--------|
| `yy` | Yank (copy) current line |
| `yw` | Yank word |
| `p` | Put (paste) after cursor |
| `P` | Put before cursor |
| `3yy` | Yank 3 lines |

### Undo and Redo
| Command | Action |
|---------|--------|
| `u` | Undo last change |
| `Ctrl+r` | Redo |
| `.` | Repeat last command |

<!-- exercise
id: ex03
title: Simulate a vi delete operation
xp: 15
difficulty: 2
sandbox_setup:
  - "printf 'ACCEPT TCP/443 0.0.0.0/0\nDROP TCP/23 0.0.0.0/0\nACCEPT TCP/80 0.0.0.0/0\n' > edit_me.txt"
validation_type: output_contains
expected: ACCEPT TCP/80
hints:
  - "Use sed to remove the second line (simulating dd in vi)."
  - "sed with a line number and 'd' deletes that line."
  - "Type: `sed -i '2d' edit_me.txt && cat edit_me.txt`"
-->
### Exercise 3: Simulate a vi delete operation
The file `edit_me.txt` has three firewall rules. Remove the second line (`DROP TCP/23`) and display the result.

---

## Search and Replace

### Searching
| Command | Action |
|---------|--------|
| `/pattern` | Search forward |
| `?pattern` | Search backward |
| `n` | Next match |
| `N` | Previous match |
| `*` | Search for word under cursor |

### Search and Replace
```
:s/old/new/          # replace first occurrence on current line
:s/old/new/g         # replace all on current line
:%s/old/new/g        # replace all in entire file
:%s/old/new/gc       # replace all with confirmation
```

<!-- exercise
id: ex04
title: Update source network in firewall rules
xp: 15
difficulty: 2
sandbox_setup:
  - "printf 'ACCEPT TCP/443 from 10.0.0.0/8\nACCEPT TCP/80 from 10.0.0.0/8\nACCEPT TCP/22 from 10.0.0.0/8\n' > firewall_rules.txt"
validation_type: output_contains
expected: "172.16.0.0/12"
hints:
  - "Use sed with the same s/old/new/g syntax that vi uses."
  - "sed can perform the same substitution as vi's :%s command."
  - "Type: `sed -i 's|10.0.0.0/8|172.16.0.0/12|g' firewall_rules.txt && cat firewall_rules.txt`"
-->
### Exercise 4: Update source network in firewall rules
The network has been re-addressed. Replace all occurrences of `10.0.0.0/8` with `172.16.0.0/12` in `firewall_rules.txt` (using sed, which uses the same syntax as vi's substitute command).

---

## Saving and Quitting

All of these are typed in Normal mode after pressing `:` (which opens the
command line at the bottom of the screen):

| Command | Action |
|---------|--------|
| `:w` | Save (write) |
| `:q` | Quit (fails if unsaved changes) |
| `:wq` | Save and quit |
| `:q!` | Quit without saving (force) |
| `:x` | Save and quit (same as `:wq`) |
| `ZZ` | Save and quit (no colon needed) |

> The most common beginner question: "How do I exit vi?" The answer is
> `Esc` then `:q!` (quit without saving) or `:wq` (save and quit).

<!-- exercise
id: ex05
title: Check for vi/vim availability
xp: 10
difficulty: 1
sandbox_setup: null
validation_type: output_regex
expected: "/(vi|vim)"
hints:
  - "Use which or type to find where vi is installed."
  - "The which command shows the path to an executable."
  - "Type: `which vi`"
-->
### Exercise 5: Check for vi/vim availability
Verify that vi is installed on your system by finding its path.

---

## Vim Extras (Beyond Basic vi)

Vim adds many features over classic vi:

- **Visual mode** (`v` for character, `V` for line, `Ctrl+v` for block) -- select text visually
- **Multiple buffers** (`:e file2.txt`, `:bn`, `:bp`)
- **Split windows** (`:split`, `:vsplit`, `Ctrl+w` to switch)
- **Syntax highlighting** (`:syntax on`)
- **Line numbers** (`:set number`)
- **Configuration** via `~/.vimrc`

```vim
" Example ~/.vimrc
set number          " show line numbers
set tabstop=4       " tab width
set expandtab       " use spaces instead of tabs
syntax on           " syntax highlighting
set hlsearch        " highlight search matches
```

<!-- exercise
id: ex06
title: Create a minimal vimrc
xp: 15
difficulty: 2
sandbox_setup: null
validation_type: file_contains
expected: my_vimrc::set number
hints:
  - "Write common vim settings to a file."
  - "Use printf or echo with redirection."
  - "Type: `printf 'set number\\nset tabstop=4\\nset expandtab\\nsyntax on\\n' > my_vimrc`"
-->
### Exercise 6: Create a minimal vimrc
Create a file called `my_vimrc` with basic vim settings including `set number` and `syntax on`.

---

## What You Learned

- **Modal editing** -- Normal mode vs Insert mode
- **Navigation** -- `hjkl`, word movement, line and file movement
- **Editing** -- delete (`dd`, `dw`, `x`), yank/put (`yy`, `p`)
- **Search** -- `/pattern`, `n`/`N`, `:%s/old/new/g`
- **Saving/quitting** -- `:w`, `:q`, `:wq`, `:q!`
- **Vim extras** -- visual mode, splits, syntax highlighting, `.vimrc`
